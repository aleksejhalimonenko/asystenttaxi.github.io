<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <meta charset="UTF-8" />
    <title>–†–∞–∑–¥–µ–ª: –î—Ä—É–≥–æ–µ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
      h2 { margin-top: 40px; }
      canvas { max-width: 100%; }
      table { border-collapse: collapse; width: 100%; margin-top: 10px; }
      th, td { border: 1px solid #ccc; padding: 8px; font-size: 14px; }
      th { background: #eee; }
      .chart-container { width: 100%; max-width: 800px; margin: auto; }
    </style>
  </head>
  <body>
    <h1>–†–∞–∑–¥–µ–ª "–î—Ä—É–≥–æ–µ"</h1>

    <h2>üìä –ü—Ä–æ–±–µ–≥ –ø–æ –º–µ—Å—è—Ü–∞–º</h2>
    <div class="chart-container">
      <canvas id="mileageChart"></canvas>
    </div>

    <h2>üß∞ –¢—é–Ω–∏–Ω–≥ –∏ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã</h2>
    <table id="tuningTable">
      <thead>
        <tr>
          <th>–¢–∏–ø</th>
          <th>–î–∞—Ç–∞</th>
          <th>–ü—Ä–æ–±–µ–≥</th>
          <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
          <th>–î–æ—Å—Ç–∞–≤–∫–∞</th>
          <th>–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–µ—Ç–∞–ª–µ–π</th>
          <th>–° –¥–æ—Å—Ç–∞–≤–∫–æ–π</th>
          <th>–†–∞–±–æ—Ç—ã</th>
          <th>–ò—Ç–æ–≥–æ</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h2>üìÑ –®—Ç—Ä–∞—Ñ—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã</h2>
    <table id="finesTable">
      <thead>
        <tr>
          <th>–¢–∏–ø</th>
          <th>–î–∞—Ç–∞</th>
          <th>–ü—Ä–æ–±–µ–≥</th>
          <th>–°—É–º–º–∞</th>
          <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      const scriptUrl = 'https://script.google.com/macros/s/AKfycbwbIVB5WCgp5YVIZWHDiWzlX4gKtMQSwBBZhdLtH4rPdu2f9gBrzGqmF-6dy5csTaF4/exec?page=other';

      fetch(scriptUrl)
        .then(res => res.json())
        .then(data => {
          // --- Chart ---
          const ctx = document.getElementById('mileageChart').getContext('2d');
          const datasets = data.mileageChart.data.map(entry => ({
            label: entry.label,
            data: entry.values,
            fill: false,
            borderColor: getRandomColor(),
            tension: 0.3
          }));

          new Chart(ctx, {
            type: 'line',
            data: {
              labels: data.mileageChart.months,
              datasets: datasets
            },
            options: {
              responsive: true,
              plugins: {
                legend: { position: 'bottom' },
                title: { display: true, text: '–ü—Ä–æ–±–µ–≥ –ø–æ –º–µ—Å—è—Ü–∞–º' }
              }
            }
          });

          // --- –¢—é–Ω–∏–Ω–≥ —Ç–∞–±–ª–∏—Ü–∞ ---
          const tuningTable = document.querySelector('#tuningTable tbody');
          data.tuning.forEach(row => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${row.type}</td>
              <td>${row.date}</td>
              <td>${row.mileage}</td>
              <td>${row.description}</td>
              <td>${row.delivery}</td>
              <td>${row.partsCost}</td>
              <td>${row.totalWithDelivery}</td>
              <td>${row.workCost}</td>
              <td>${row.total}</td>
            `;
            tuningTable.appendChild(tr);
          });

          // --- –®—Ç—Ä–∞—Ñ—ã —Ç–∞–±–ª–∏—Ü–∞ ---
          const finesTable = document.querySelector('#finesTable tbody');
          data.fines.forEach(row => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${row.type}</td>
              <td>${row.date}</td>
              <td>${row.mileage}</td>
              <td>${row.cost}</td>
              <td>${row.comment}</td>
            `;
            finesTable.appendChild(tr);
          });
        });

      function getRandomColor() {
        return `hsl(${Math.floor(Math.random() * 360)}, 70%, 60%)`;
      }
    </script>
  </body>
</html>
